makeundirected_str = function ( foreign ) {
    var extension = {};
    // deep copy of foreign
    for ( var m in foreign ) {
        extension[m] = [];
        for ( var n in foreign[m] ) {
            extension[m].push(foreign[m][n]);
        }
    }  

    // pointing backwards
    for ( var m in foreign ) {
        for ( var n in foreign[m] ) {
            var ostr = foreign[m][n];
            if ( ! extension.hasOwnProperty(ostr) ) {
                extension[ostr] = [];
            }
            var unstr = m;
            extension[ostr].push(unstr);
        }
    } 
    return extension;
};

a2p = function(a) {
	var s = ""; 
	for (var g in a) {
		s += "[\""+a[g]+"\"]";
	}
	return s;
	
}

o2s = function(e) {
	return JSON.stringify ( [e.id , e.ptr , e.index] ); 
}

s2o = function(e) {
    var x = JSON.parse(e);
    return {
        id : x[0],
        ptr : x[1],
        index : x[2]
    }   
}
cloneObject = function(o) {
	return JSON.parse(JSON.stringify(o));
}

ptrUnsplit = function (ptr) {
	var s = "";
	for (var v in ptr)
		s+='["'+ptr[v]+'"]';
	return s;
}

setObj = function(obj, ptr) {
	var ss = '["'+ptr[0]+'"]';
	for (var f = 1; f < ptr.length; f++) {
		console.log(obj+""+ss);
		if (!eval(obj+""+ss)) {
			ss += '["'+ptr[f]+'"]';
			eval (obj+ss+"= {}")
		}									
	}
}

ptrSplit = function (ptrs) {
	var rcarray = []; 
	ptrs = ptrs.substr(2,ptrs.length);
	ptrs = ptrs.substr(0,ptrs.length-2);
	rcarray = ptrs.split('"]["');
	return rcarray;
}

makeundirected = function ( foreign ) {
    var extension = {};
    // deep copy of foreign
    for ( var m in foreign ) {
        extension[m] = [];
        for ( var n in foreign[m] ) {
            extension[m].push(foreign[m][n]);
        }
    }  

    // pointing backwards
    for ( var m in foreign ) {
        for ( var n in foreign[m] ) {
            var ostr = myforeignstring(foreign[m][n]);
            if ( ! extension.hasOwnProperty(ostr) ) {
                extension[myforeignstring(ostr)] = [];
            }
            var unstr = {};
            unstr.id =JSON.parse(m)[0];
            unstr.ptr =JSON.parse(m)[1];
            unstr.index =JSON.parse(m)[2];
            extension[ostr].push(unstr);
        }
    }  
    return extension;
}

// for mongo
if ( typeof exports !== typeof undefined ) {
	exports.makeundirected = makeundirected;
	//exports.makeundirected_str = makeundirected_str;
}

myforeignstring = function(e) {
	return JSON.stringify ( [e.id , e.ptr , e.index ] ); 
}

